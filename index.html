<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ ≈öwiƒÖteczna Maszyna LosujƒÖca</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes bounce-in {
            0% { transform: scale(0.9) translateY(20px); opacity: 0; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-8px) rotate(-3deg) scale(0.98); }
            75% { transform: translateX(8px) rotate(3deg) scale(0.98); }
        }

        @keyframes snowfall {
            0% {
                transform: translateY(-10px) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) translateX(100px);
                opacity: 0;
            }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.9); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .bounce-in {
            animation: bounce-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            animation: snowfall linear infinite;
            pointer-events: none;
            z-index: 1000;
            text-shadow: 0 0 8px rgba(255,255,255,0.9);
        }

        .star {
            animation: twinkle 2.5s ease-in-out infinite;
        }

        .participant-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .participant-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        body {
            background: linear-gradient(135deg, #0d3b2e 0%, #0a1f1a 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Glassmorphism cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .glass-card-alt {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .christmas-gradient-text {
            background: linear-gradient(135deg, #c41e3a 0%, #165b33 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .gold-text {
            color: #d4af37;
            text-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .snow-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .christmas-ornament {
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        /* Modern button styles */
        .btn-primary {
            background: linear-gradient(135deg, #c41e3a 0%, #a01729 100%);
            box-shadow: 0 4px 16px rgba(196, 30, 58, 0.4);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 24px rgba(196, 30, 58, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #0c5f31 0%, #0a4a26 100%);
            box-shadow: 0 4px 16px rgba(12, 95, 49, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 24px rgba(12, 95, 49, 0.5);
        }

        .btn-accent {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);
        }

        .btn-accent:hover {
            box-shadow: 0 6px 24px rgba(245, 158, 11, 0.5);
        }

        /* Gradient orbs for depth */
        @keyframes orb-float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(20px, -20px) scale(1.05); }
            66% { transform: translate(-20px, 20px) scale(0.95); }
        }

        @keyframes orb-float-center {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .gradient-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.25;
            pointer-events: none;
            z-index: 1;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #c41e3a 0%, transparent 70%);
            top: -100px;
            right: -100px;
            animation: orb-float 20s ease-in-out infinite;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #0c5f31 0%, transparent 70%);
            bottom: -100px;
            left: -100px;
            animation: orb-float 25s ease-in-out infinite;
            animation-delay: 5s;
        }

        .orb-3 {
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, #165b33 0%, transparent 70%);
            top: 50%;
            left: 50%;
            animation: orb-float-center 30s ease-in-out infinite;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .gradient-orb {
                filter: blur(60px);
                opacity: 0.2;
            }

            .orb-1 {
                width: 300px;
                height: 300px;
            }

            .orb-2 {
                width: 250px;
                height: 250px;
            }

            .orb-3 {
                width: 200px;
                height: 200px;
            }

            .glass-card {
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
            }

            /* Better touch targets on mobile */
            button {
                min-height: 44px;
            }

            input {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Smaller snowflakes on mobile */
            .snowflake {
                font-size: 0.8em;
            }
        }

        /* Very small screens */
        @media (max-width: 400px) {
            .max-w-3xl {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }

            .glass-card {
                padding: 1.25rem !important;
            }
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border-radius: 16px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: toast-slide-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            min-width: 280px;
        }

        .toast.toast-exit {
            animation: toast-slide-out 0.3s ease-out forwards;
        }

        .toast-success {
            border-left: 4px solid #10b981;
        }

        .toast-error {
            border-left: 4px solid #ef4444;
        }

        .toast-warning {
            border-left: 4px solid #f59e0b;
        }

        .toast-info {
            border-left: 4px solid #3b82f6;
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 2px;
            font-size: 14px;
        }

        .toast-message {
            color: #6b7280;
            font-size: 13px;
            line-height: 1.4;
        }

        @keyframes toast-slide-in {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toast-slide-out {
            from {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            to {
                transform: translateX(400px) scale(0.9);
                opacity: 0;
            }
        }

        @media (max-width: 640px) {
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .toast {
                min-width: auto;
                width: 100%;
            }
        }

        /* Confirm modal */
        .confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            animation: fade-in 0.2s ease-out;
            padding: 20px;
            transition: opacity 0.2s ease-out;
        }

        .confirm-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 28px;
            max-width: 420px;
            width: 100%;
            animation: modal-slide-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .confirm-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 12px;
            text-align: center;
        }

        .confirm-message {
            color: #6b7280;
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 24px;
            text-align: center;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
        }

        .confirm-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-button-cancel {
            background: #f3f4f6;
            color: #6b7280;
        }

        .confirm-button-cancel:hover {
            background: #e5e7eb;
        }

        .confirm-button-confirm {
            background: linear-gradient(135deg, #c41e3a 0%, #a01729 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3);
        }

        .confirm-button-confirm:hover {
            box-shadow: 0 6px 16px rgba(196, 30, 58, 0.4);
            transform: translateY(-1px);
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modal-slide-in {
            from {
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- Toast notifications container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Gradient orbs for depth -->
    <div class="gradient-orb orb-1"></div>
    <div class="gradient-orb orb-2"></div>
    <div class="gradient-orb orb-3"></div>

    <!-- Snow overlay -->
    <div class="snow-overlay" id="snow-container"></div>

    <div class="max-w-3xl mx-auto relative z-10">

        <!-- Screen 1: Setup - Dodawanie uczestnik√≥w -->
        <div id="setup-screen" class="screen">
            <div class="glass-card rounded-2xl md:rounded-3xl p-6 md:p-10 bounce-in">

                <!-- Christmas Header -->
                <div class="text-center mb-6 md:mb-8">
                    <div class="text-6xl md:text-7xl mb-3 md:mb-4">
                        <span class="christmas-ornament">üéÑ</span>
                    </div>
                    <h1 class="text-3xl md:text-5xl font-bold mb-2 md:mb-3 christmas-gradient-text leading-tight px-2">
                        ≈öwiƒÖteczna Maszyna LosujƒÖca
                    </h1>
                    <p class="text-xs md:text-base gold-text font-semibold mb-3 md:mb-4">
                        ‚ú® Edycja ≈öwiƒÖt <span id="current-year">2025</span> ‚ú®
                    </p>
                    <div class="flex justify-center gap-2 md:gap-3 text-lg md:text-2xl mb-1 md:mb-2">
                        <span class="star">‚≠ê</span>
                        <span class="star" style="animation-delay: 0.3s">‚ú®</span>
                        <span class="star" style="animation-delay: 0.6s">‚≠ê</span>
                    </div>
                </div>

                <p class="text-center text-gray-700 mb-6 md:mb-10 text-sm md:text-lg px-2">Dodaj uczestnik√≥w i rozpocznij losowanie prezent√≥w!</p>

                <!-- Formularz dodawania -->
                <div class="mb-6 md:mb-8">
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <input
                            type="text"
                            id="participant-input"
                            placeholder="Wpisz imiƒô uczestnika..."
                            class="flex-1 px-4 md:px-5 py-3 md:py-3.5 bg-white/60 backdrop-blur-sm border-2 border-green-500/30 rounded-xl md:rounded-2xl focus:outline-none focus:border-red-500/50 focus:bg-white/80 text-base md:text-lg transition-all shadow-sm"
                            autocomplete="off"
                        >
                        <button
                            onclick="addParticipant()"
                            class="btn-secondary text-white px-5 md:px-7 py-3 md:py-3.5 rounded-xl md:rounded-2xl font-semibold transition-all transform hover:scale-105 text-base whitespace-nowrap"
                        >
                            <span class="text-lg">+</span> Dodaj
                        </button>
                    </div>
                    <p class="text-xs md:text-sm text-gray-600 mt-2 md:mt-3 px-1">Minimum 2 osoby potrzebne do losowania</p>
                </div>

                <!-- Lista uczestnik√≥w -->
                <div id="participants-list" class="mb-6 md:mb-8 space-y-2 md:space-y-3">
                    <!-- Dynamicznie dodawane karty uczestnik√≥w -->
                </div>

                <!-- Przycisk rozpoczƒôcia -->
                <button
                    id="start-button"
                    onclick="startDrawing()"
                    disabled
                    class="w-full btn-primary text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-bold text-base md:text-xl transition-all transform hover:scale-105 disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
                >
                    üéÖ ROZPOCZNIJ LOSOWANIE! üéÅ
                </button>
            </div>
        </div>

        <!-- Screen 2: Drawing - Losowanie -->
        <div id="drawing-screen" class="screen hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl p-6 md:p-10 bounce-in">
                <!-- Christmas decoration -->
                <div class="text-center mb-5 md:mb-6">
                    <div class="flex justify-center gap-3 md:gap-4 text-2xl md:text-4xl">
                        <span class="star">üéÑ</span>
                        <span class="star" style="animation-delay: 0.2s">‚õÑ</span>
                        <span class="star" style="animation-delay: 0.4s">üéÑ</span>
                    </div>
                </div>

                <!-- Progress -->
                <div class="mb-6 md:mb-8">
                    <div class="flex justify-between text-xs md:text-sm font-medium text-gray-700 mb-2 md:mb-3">
                        <span>Postƒôp</span>
                        <span id="progress-text">0/0</span>
                    </div>
                    <div class="w-full bg-white/50 backdrop-blur-sm rounded-full h-2.5 md:h-3.5 shadow-inner border border-gray-200/50">
                        <div id="progress-bar" class="bg-gradient-to-r from-red-600 to-green-600 h-full rounded-full transition-all duration-500 shadow-sm" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Osoba losujƒÖca -->
                <div class="text-center mb-8 md:mb-10">
                    <p class="text-sm md:text-lg text-gray-600 mb-2 md:mb-3 font-medium">Teraz kolej na:</p>
                    <h2 id="current-person" class="text-3xl md:text-6xl font-bold christmas-gradient-text mb-2 px-2">
                        ---
                    </h2>
                    <p class="text-2xl md:text-4xl">üéÖ</p>
                </div>

                <!-- Wynik losowania (ukryty poczƒÖtkowo) -->
                <div id="result-container" class="hidden mb-8 md:mb-10">
                    <div class="glass-card-alt rounded-xl md:rounded-2xl p-5 md:p-8 text-center border-3 border-red-400/40 shadow-xl">
                        <p class="text-sm md:text-xl text-gray-700 mb-2 md:mb-3 font-medium">Kupujesz prezent dla:</p>
                        <p id="drawn-person" class="text-2xl md:text-5xl font-bold text-red-700 mb-2 md:mb-3 px-2 break-words">---</p>
                        <p class="text-3xl md:text-5xl">üéÅ</p>
                        <div class="flex justify-center gap-2 md:gap-3 mt-3 md:mt-4 text-lg md:text-2xl">
                            <span class="star">‚ú®</span>
                            <span class="star" style="animation-delay: 0.3s">‚≠ê</span>
                            <span class="star" style="animation-delay: 0.6s">‚ú®</span>
                        </div>

                        <!-- Budget voting slider -->
                        <div class="mt-6 md:mt-8 pt-6 md:pt-8 border-t-2 border-gray-200/50">
                            <p class="text-sm md:text-lg text-gray-700 mb-3 md:mb-4 font-medium">üí∞ Proponowana kwota prezentu:</p>
                            <div class="flex items-center justify-center gap-3 md:gap-4 mb-3">
                                <span class="text-xl md:text-3xl font-bold text-green-700" id="budget-display">100 z≈Ç</span>
                            </div>
                            <input
                                type="range"
                                id="budget-slider"
                                min="50"
                                max="300"
                                step="50"
                                value="100"
                                class="w-full h-3 bg-gradient-to-r from-green-200 via-yellow-200 to-red-200 rounded-lg appearance-none cursor-pointer accent-green-600"
                                oninput="updateBudgetDisplay()"
                            >
                            <div class="flex justify-between text-xs md:text-sm text-gray-600 mt-2">
                                <span>50 z≈Ç</span>
                                <span>100 z≈Ç</span>
                                <span>150 z≈Ç</span>
                                <span>200 z≈Ç</span>
                                <span>250 z≈Ç</span>
                                <span>300 z≈Ç</span>
                            </div>
                            <p class="text-xs md:text-sm text-gray-500 mt-3 italic">Tw√≥j g≈Ços jest anonimowy i pomo≈ºe ustaliƒá wsp√≥lny bud≈ºet</p>
                        </div>
                    </div>
                </div>

                <!-- Przyciski -->
                <div class="space-y-2.5 md:space-y-3">
                    <button
                        id="draw-button"
                        onclick="performDraw()"
                        class="w-full btn-primary text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-bold text-base md:text-xl transition-all transform hover:scale-105"
                    >
                        üé≤ LOSUJ! üé≤
                    </button>

                    <button
                        id="next-button"
                        onclick="nextPerson()"
                        class="hidden w-full btn-secondary text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-semibold text-sm md:text-lg transition-all transform hover:scale-105"
                    >
                        Zrozumia≈Çem/am, przeka≈º dalej! ‚Üí
                    </button>
                </div>

                <!-- Przycisk powrotu -->
                <button
                    onclick="resetToSetup()"
                    class="w-full mt-4 md:mt-6 text-gray-600 hover:text-gray-800 py-2 text-xs md:text-sm font-medium transition-colors"
                >
                    ‚Üê Wr√≥ƒá do edycji listy
                </button>
            </div>
        </div>

        <!-- Screen 3: Complete - Zako≈Ñczenie -->
        <div id="complete-screen" class="screen hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl p-6 md:p-10 text-center bounce-in">
                <div class="text-6xl md:text-9xl mb-5 md:mb-6">
                    <span class="christmas-ornament">üéÑ</span>
                </div>
                <h2 class="text-3xl md:text-6xl font-bold christmas-gradient-text mb-4 md:mb-6 px-2">
                    Wszyscy wylosowali!
                </h2>
                <p class="text-base md:text-xl text-gray-700 mb-5 md:mb-6 px-2">
                    Teraz wszyscy wiedzƒÖ komu kupiƒá prezent!
                </p>
                <div class="flex justify-center gap-3 md:gap-4 text-3xl md:text-6xl mb-6 md:mb-8">
                    <span class="star">üéÅ</span>
                    <span class="star" style="animation-delay: 0.2s">‚õÑ</span>
                    <span class="star" style="animation-delay: 0.4s">üéÖ</span>
                    <span class="star" style="animation-delay: 0.6s">üîî</span>
                </div>
                <p class="gold-text text-xl md:text-3xl font-bold mb-6 md:mb-8">
                    ‚ú® Weso≈Çych ≈öwiƒÖt! ‚ú®
                </p>

                <!-- Alert o screenshocie -->
                <div class="glass-card-alt border-2 border-yellow-400/50 rounded-xl md:rounded-2xl p-4 md:p-5 mb-6 md:mb-8 text-left shadow-lg">
                    <div class="flex items-start gap-2 md:gap-3">
                        <div class="text-2xl md:text-3xl flex-shrink-0">üì∏</div>
                        <div>
                            <p class="font-bold text-yellow-800 mb-1 md:mb-2 text-sm md:text-base">Pamiƒôtaj o screenshocie!</p>
                            <p class="text-xs md:text-sm text-yellow-700 leading-relaxed">Kliknij przycisk poni≈ºej i zr√≥b screenshot podsumowania, ≈ºeby mieƒá zapisane kto komu kupuje prezent!</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-2.5 md:space-y-3">
                    <button
                        onclick="showSummary()"
                        class="w-full btn-accent text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-bold text-sm md:text-lg transition-all transform hover:scale-105"
                    >
                        üìã Poka≈º podsumowanie (tylko dla organizatora!)
                    </button>
                    <button
                        onclick="showBudgetStats()"
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-bold text-sm md:text-lg hover:from-green-700 hover:to-emerald-700 transition-all transform hover:scale-105 shadow-lg"
                    >
                        üí∞ Poka≈º statystyki bud≈ºetu
                    </button>
                    <button
                        onclick="resetAll()"
                        class="w-full btn-primary text-white px-6 md:px-8 py-3.5 md:py-5 rounded-xl md:rounded-2xl font-semibold text-sm md:text-lg transition-all transform hover:scale-105"
                    >
                        üîÑ Zacznij od nowa
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 4: Summary - Podsumowanie -->
        <div id="summary-screen" class="screen hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl p-6 md:p-10 bounce-in">
                <div class="text-center mb-6 md:mb-8">
                    <div class="text-4xl md:text-6xl mb-2 md:mb-3">üìã</div>
                    <h2 class="text-2xl md:text-4xl font-bold christmas-gradient-text mb-3 px-2">
                        Podsumowanie losowania
                    </h2>
                    <p class="text-xs md:text-sm text-red-600 font-semibold bg-red-50/80 py-2 px-3 md:px-4 rounded-lg md:rounded-xl inline-block">‚ö†Ô∏è Nie pokazuj tego ekranu uczestnikom!</p>
                </div>

                <!-- Lista przypisa≈Ñ -->
                <div id="summary-list" class="mb-6 md:mb-8 space-y-2 md:space-y-3">
                    <!-- Dynamicznie generowane -->
                </div>

                <!-- Przyciski -->
                <div class="space-y-2.5 md:space-y-3">
                    <button
                        onclick="copyToClipboard()"
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-bold text-sm md:text-lg hover:from-blue-700 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg"
                    >
                        üìã Kopiuj do schowka
                    </button>
                    <button
                        onclick="showScreen('complete-screen')"
                        class="w-full btn-secondary text-white px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-semibold text-sm md:text-lg transition-all transform hover:scale-105"
                    >
                        ‚Üê Wr√≥ƒá
                    </button>
                    <button
                        onclick="resetAll()"
                        class="w-full bg-gray-600 text-white px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-semibold text-sm md:text-lg hover:bg-gray-700 transition-all shadow-md"
                    >
                        üîÑ Zacznij od nowa
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 5: Budget Stats - Statystyki bud≈ºetu -->
        <div id="budget-stats-screen" class="screen hidden">
            <div class="glass-card rounded-2xl md:rounded-3xl p-6 md:p-10 bounce-in">
                <div class="text-center mb-6 md:mb-8">
                    <div class="text-4xl md:text-6xl mb-2 md:mb-3">üí∞</div>
                    <h2 class="text-2xl md:text-4xl font-bold christmas-gradient-text mb-3 px-2">
                        Statystyki bud≈ºetu prezent√≥w
                    </h2>
                    <p class="text-xs md:text-sm text-gray-600 px-2">Anonimowe g≈Çosowanie - wyniki zbiorowe</p>
                </div>

                <!-- G≈Ç√≥wne statystyki -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mb-6 md:mb-8">
                    <div class="glass-card-alt rounded-xl p-4 md:p-5 text-center">
                        <p class="text-xs md:text-sm text-gray-600 mb-1 md:mb-2">≈örednia kwota</p>
                        <p class="text-2xl md:text-4xl font-bold text-green-700" id="avg-budget">---</p>
                    </div>
                    <div class="glass-card-alt rounded-xl p-4 md:p-5 text-center">
                        <p class="text-xs md:text-sm text-gray-600 mb-1 md:mb-2">Minimum</p>
                        <p class="text-2xl md:text-4xl font-bold text-blue-700" id="min-budget">---</p>
                    </div>
                    <div class="glass-card-alt rounded-xl p-4 md:p-5 text-center">
                        <p class="text-xs md:text-sm text-gray-600 mb-1 md:mb-2">Maksimum</p>
                        <p class="text-2xl md:text-4xl font-bold text-red-700" id="max-budget">---</p>
                    </div>
                </div>

                <!-- Histogram g≈Ços√≥w -->
                <div class="mb-6 md:mb-8">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4 md:mb-5 text-center">Rozk≈Çad g≈Ços√≥w</h3>
                    <div id="budget-histogram" class="space-y-3 md:space-y-4">
                        <!-- Dynamicznie generowane -->
                    </div>
                </div>

                <!-- Przyciski -->
                <div class="space-y-2.5 md:space-y-3">
                    <button
                        onclick="showScreen('complete-screen')"
                        class="w-full btn-secondary text-white px-6 md:px-8 py-3.5 md:py-4 rounded-xl md:rounded-2xl font-semibold text-sm md:text-lg transition-all transform hover:scale-105"
                    >
                        ‚Üê Wr√≥ƒá
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // State
        let state = {
            participants: [],
            assignments: [],
            currentIndex: 0,
            hasDrawn: [],
            budgetVotes: [] // {person: string, amount: number}
        };

        // Toast notification system
        function showToast(message, type = 'info', title = '') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            const titles = {
                success: title || 'Sukces',
                error: title || 'B≈ÇƒÖd',
                warning: title || 'Uwaga',
                info: title || 'Informacja'
            };

            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-content">
                    <div class="toast-title">${titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('toast-exit');
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 3500);
        }

        // Confirm dialog system
        function showConfirm(message, title = 'Potwierd≈∫', icon = '‚ö†Ô∏è') {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'confirm-overlay';
                overlay.innerHTML = `
                    <div class="confirm-modal">
                        <div class="confirm-icon">${icon}</div>
                        <div class="confirm-title">${title}</div>
                        <div class="confirm-message">${message}</div>
                        <div class="confirm-buttons">
                            <button class="confirm-button confirm-button-cancel" id="confirm-cancel">Anuluj</button>
                            <button class="confirm-button confirm-button-confirm" id="confirm-ok">Potwierd≈∫</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(overlay);

                const handleConfirm = (result) => {
                    overlay.style.opacity = '0';
                    document.removeEventListener('keydown', keyHandler);
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                    }, 200);
                    resolve(result);
                };

                const keyHandler = (e) => {
                    if (e.key === 'Enter') handleConfirm(true);
                    if (e.key === 'Escape') handleConfirm(false);
                };

                document.getElementById('confirm-ok').addEventListener('click', () => handleConfirm(true));
                document.getElementById('confirm-cancel').addEventListener('click', () => handleConfirm(false));
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) handleConfirm(false);
                });
                document.addEventListener('keydown', keyHandler);

                // Focus the confirm button
                setTimeout(() => document.getElementById('confirm-ok').focus(), 100);
            });
        }

        // Sound effects using Web Audio API
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                if (type === 'add') {
                    // Weso≈Çe "ding" przy dodaniu uczestnika
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(1047, audioContext.currentTime + 0.05);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15);
                } else if (type === 'start') {
                    // Fanfara startowa przy rozpoczƒôciu
                    oscillator.frequency.setValueAtTime(392, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.25, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                } else if (type === 'draw') {
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } else if (type === 'reveal') {
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } else if (type === 'complete') {
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.15);
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.3);
                    oscillator.frequency.setValueAtTime(1047, audioContext.currentTime + 0.45);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.6);
                }
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Create snowfall effect
        function createSnowfall() {
            const container = document.getElementById('snow-container');
            const snowflakeCount = 30;

            for (let i = 0; i < snowflakeCount; i++) {
                setTimeout(() => {
                    const snowflake = document.createElement('div');
                    snowflake.className = 'snowflake';
                    snowflake.innerHTML = '‚ùÑ';
                    snowflake.style.left = Math.random() * 100 + '%';
                    snowflake.style.fontSize = (Math.random() + 0.5) + 'em';
                    snowflake.style.animationDuration = (Math.random() * 10 + 15) + 's';
                    snowflake.style.animationDelay = Math.random() * 5 + 's';
                    container.appendChild(snowflake);
                }, i * 200);
            }
        }

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('secret-santa-state-christmas');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('secret-santa-state-christmas', JSON.stringify(state));
        }

        // Initialize
        function init() {
            loadState();
            renderParticipants();
            updateStartButton();
            createSnowfall();

            // Set current year
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // Enter key support
            document.getElementById('participant-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addParticipant();
                }
            });
        }

        // Add participant
        function addParticipant() {
            const input = document.getElementById('participant-input');
            const name = input.value.trim();
            const MAX_NAME_LENGTH = 30;

            if (!name) {
                return;
            }

            if (name.length > MAX_NAME_LENGTH) {
                showToast(`Imiƒô mo≈ºe mieƒá maksymalnie ${MAX_NAME_LENGTH} znak√≥w üéÑ`, 'warning');
                return;
            }

            if (state.participants.includes(name)) {
                showToast('Ta osoba ju≈º jest na li≈õcie! üéÑ', 'warning');
                input.value = '';
                return;
            }

            state.participants.push(name);
            input.value = '';
            input.focus();

            playSound('add');
            saveState();
            renderParticipants();
            updateStartButton();
        }

        // Remove participant
        function removeParticipant(index) {
            state.participants.splice(index, 1);
            saveState();
            renderParticipants();
            updateStartButton();
        }

        // Render participants list
        function renderParticipants() {
            const list = document.getElementById('participants-list');

            if (state.participants.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-10 text-base">Brak uczestnik√≥w. Dodaj pierwszƒÖ osobƒô! üéÑ</p>';
                return;
            }

            const christmasColors = [
                'from-red-600 to-red-700',
                'from-green-600 to-green-700',
                'from-red-500 to-green-600',
                'from-emerald-600 to-teal-700',
                'from-rose-600 to-red-700',
                'from-lime-600 to-green-700'
            ];

            const christmasEmojis = ['üéÖ', 'üéÑ', '‚õÑ', 'üéÅ', 'üîî', '‚≠ê', '‚ùÑÔ∏è', 'ü¶å'];

            list.innerHTML = state.participants.map((name, index) => `
                <div class="participant-card flex items-center justify-between bg-gradient-to-r ${christmasColors[index % christmasColors.length]} text-white px-4 md:px-5 py-3 md:py-4 rounded-xl md:rounded-2xl shadow-lg hover:shadow-xl">
                    <div class="flex items-center gap-2 md:gap-3 flex-1 min-w-0">
                        <span class="text-xl md:text-3xl flex-shrink-0">${christmasEmojis[index % christmasEmojis.length]}</span>
                        <span class="font-semibold text-sm md:text-lg truncate">${escapeHtml(name)}</span>
                    </div>
                    <button
                        onclick="removeParticipant(${index})"
                        class="text-white/90 hover:text-white hover:bg-white/20 rounded-lg font-bold text-lg md:text-xl px-2 md:px-3 py-1 transition-all flex-shrink-0 ml-2"
                    >
                        ‚úï
                    </button>
                </div>
            `).join('');
        }

        // Update start button state
        function updateStartButton() {
            const button = document.getElementById('start-button');
            button.disabled = state.participants.length < 2;
        }

        // Start drawing process
        function startDrawing() {
            if (state.participants.length < 2) {
                showToast('Potrzeba minimum 2 osoby do losowania! üéÑ', 'warning');
                return;
            }

            playSound('start');
            state.assignments = generateDerangement(state.participants);
            state.currentIndex = 0;
            state.hasDrawn = [];
            state.budgetVotes = [];
            saveState();

            showScreen('drawing-screen');
            updateDrawingScreen();
        }

        // Generate derangement
        function generateDerangement(participants) {
            const n = participants.length;
            let attempts = 0;
            const maxAttempts = 1000;

            while (attempts < maxAttempts) {
                const shuffled = [...participants];

                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }

                let isValid = true;
                for (let i = 0; i < n; i++) {
                    if (participants[i] === shuffled[i]) {
                        isValid = false;
                        break;
                    }
                }

                if (isValid) {
                    return shuffled;
                }

                attempts++;
            }

            const result = [...participants];
            const first = result.shift();
            result.push(first);
            return result;
        }

        // Update drawing screen
        function updateDrawingScreen() {
            document.getElementById('current-person').textContent = state.participants[state.currentIndex];

            const completed = state.hasDrawn.length;
            const total = state.participants.length;
            const percentage = (completed / total) * 100;

            document.getElementById('progress-text').textContent = `${completed}/${total}`;
            document.getElementById('progress-bar').style.width = `${percentage}%`;

            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('draw-button').classList.remove('hidden');
            document.getElementById('next-button').classList.add('hidden');

            // Reset budget slider to default
            const slider = document.getElementById('budget-slider');
            if (slider) {
                slider.value = 100;
                updateBudgetDisplay();
            }
        }

        // Update budget display
        function updateBudgetDisplay() {
            const slider = document.getElementById('budget-slider');
            const display = document.getElementById('budget-display');
            if (slider && display) {
                display.textContent = `${slider.value} z≈Ç`;
            }
        }

        // Perform draw
        function performDraw() {
            const currentPerson = state.participants[state.currentIndex];
            const drawnPerson = state.assignments[state.currentIndex];

            playSound('draw');

            const button = document.getElementById('draw-button');
            button.classList.add('shake');
            setTimeout(() => button.classList.remove('shake'), 500);

            setTimeout(() => {
                playSound('reveal');
                document.getElementById('drawn-person').textContent = drawnPerson;
                document.getElementById('result-container').classList.remove('hidden');
                document.getElementById('result-container').classList.add('bounce-in');

                document.getElementById('draw-button').classList.add('hidden');
                document.getElementById('next-button').classList.remove('hidden');

                state.hasDrawn.push(currentPerson);
                saveState();

                const completed = state.hasDrawn.length;
                const total = state.participants.length;
                const percentage = (completed / total) * 100;
                document.getElementById('progress-text').textContent = `${completed}/${total}`;
                document.getElementById('progress-bar').style.width = `${percentage}%`;
            }, 300);
        }

        // Next person
        function nextPerson() {
            // Save budget vote
            const slider = document.getElementById('budget-slider');
            const currentPerson = state.participants[state.currentIndex];
            if (slider && currentPerson) {
                const amount = parseInt(slider.value);
                state.budgetVotes.push({
                    person: currentPerson,
                    amount: amount
                });
                saveState();
            }

            state.currentIndex++;

            if (state.currentIndex >= state.participants.length) {
                showComplete();
            } else {
                updateDrawingScreen();
            }
        }

        // Show complete screen
        function showComplete() {
            showScreen('complete-screen');
            playSound('complete');
            createChristmasConfetti();
        }

        // Create Christmas confetti
        function createChristmasConfetti() {
            const emojis = ['üéÑ', '‚ùÑÔ∏è', 'üéÅ', '‚≠ê', 'üîî', 'üéÖ'];
            const confettiCount = 40;

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-50px';
                    confetti.style.fontSize = '2em';
                    confetti.style.zIndex = '9999';
                    confetti.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];

                    const duration = Math.random() * 2 + 3;
                    const rotation = Math.random() * 720 - 360;

                    confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) rotate(${rotation}deg)`, opacity: 0 }
                    ], {
                        duration: duration * 1000,
                        easing: 'linear'
                    });

                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), duration * 1000);
                }, i * 40);
            }
        }

        // Reset to setup
        async function resetToSetup() {
            const confirmed = await showConfirm(
                'Postƒôp losowania zostanie utracony.',
                'Wr√≥ƒá do edycji?',
                'üîô'
            );

            if (confirmed) {
                state.assignments = [];
                state.currentIndex = 0;
                state.hasDrawn = [];
                state.budgetVotes = [];
                saveState();
                showScreen('setup-screen');
            }
        }

        // Show summary
        function showSummary() {
            playSound('reveal');
            renderSummary();
            showScreen('summary-screen');
        }

        // Render summary
        function renderSummary() {
            const list = document.getElementById('summary-list');

            const christmasColors = [
                'from-red-600 to-red-700',
                'from-green-600 to-green-700',
                'from-red-500 to-green-600',
                'from-emerald-600 to-teal-700',
                'from-rose-600 to-red-700',
                'from-lime-600 to-green-700'
            ];

            list.innerHTML = state.participants.map((person, index) => {
                const recipient = state.assignments[index];
                return `
                    <div class="bg-gradient-to-r ${christmasColors[index % christmasColors.length]} text-white px-4 md:px-5 py-3 md:py-4 rounded-xl md:rounded-2xl shadow-lg">
                        <div class="flex items-center justify-between gap-2">
                            <span class="font-semibold text-sm md:text-lg truncate flex-shrink">${escapeHtml(person)}</span>
                            <span class="text-sm md:text-base opacity-80 flex-shrink-0">‚Üí</span>
                            <span class="font-bold text-sm md:text-lg truncate flex-shrink">${escapeHtml(recipient)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Copy results to clipboard
        function copyToClipboard() {
            const year = new Date().getFullYear();
            let text = `üéÑ ≈öwiƒÖteczna Maszyna LosujƒÖca - Wyniki ${year} üéÑ\n\n`;

            state.participants.forEach((person, index) => {
                const recipient = state.assignments[index];
                text += `${person} ‚Üí ${recipient}\n`;
            });

            text += `\nWeso≈Çych ≈öwiƒÖt! üéÖüéÅ`;

            navigator.clipboard.writeText(text).then(() => {
                showToast('Wyniki zosta≈Çy skopiowane do schowka! üìã', 'success');
            }).catch(() => {
                showToast('Nie uda≈Ço siƒô skopiowaƒá. Spr√≥buj ponownie.', 'error');
            });
        }

        // Show budget stats
        function showBudgetStats() {
            if (!state.budgetVotes || state.budgetVotes.length === 0) {
                showToast('Brak danych o g≈Çosowaniu na kwoty! üí∞', 'warning');
                return;
            }

            playSound('reveal');
            renderBudgetStats();
            showScreen('budget-stats-screen');
        }

        // Render budget statistics
        function renderBudgetStats() {
            if (!state.budgetVotes || state.budgetVotes.length === 0) {
                return;
            }

            // Calculate statistics
            const amounts = state.budgetVotes.map(v => v.amount);
            const sum = amounts.reduce((acc, val) => acc + val, 0);
            const avg = Math.round(sum / amounts.length);
            const min = Math.min(...amounts);
            const max = Math.max(...amounts);

            // Update stats display
            document.getElementById('avg-budget').textContent = `${avg} z≈Ç`;
            document.getElementById('min-budget').textContent = `${min} z≈Ç`;
            document.getElementById('max-budget').textContent = `${max} z≈Ç`;

            // Create histogram data
            const buckets = [50, 100, 150, 200, 250, 300];
            const counts = {};
            buckets.forEach(bucket => counts[bucket] = 0);
            amounts.forEach(amount => {
                if (counts[amount] !== undefined) {
                    counts[amount]++;
                }
            });

            const maxCount = Math.max(...Object.values(counts));
            const histogram = document.getElementById('budget-histogram');

            histogram.innerHTML = buckets.map(bucket => {
                const count = counts[bucket];
                const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
                const barColors = {
                    50: 'from-green-500 to-green-600',
                    100: 'from-emerald-500 to-emerald-600',
                    150: 'from-yellow-500 to-yellow-600',
                    200: 'from-orange-500 to-orange-600',
                    250: 'from-red-500 to-red-600',
                    300: 'from-rose-500 to-rose-600'
                };

                return `
                    <div class="space-y-1 md:space-y-2">
                        <div class="flex items-center justify-between text-xs md:text-sm text-gray-700">
                            <span class="font-semibold">${bucket} z≈Ç</span>
                            <span class="text-gray-600">${count} ${count === 1 ? 'g≈Ços' : count < 5 ? 'g≈Çosy' : 'g≈Ços√≥w'}</span>
                        </div>
                        <div class="relative w-full bg-gray-200 rounded-full h-6 md:h-8 overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-to-r ${barColors[bucket]} transition-all duration-500 rounded-full flex items-center justify-end pr-2 md:pr-3"
                                 style="width: ${percentage}%">
                                ${count > 0 ? `<span class="text-white font-bold text-xs md:text-sm">${count}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Reset all
        async function resetAll() {
            const confirmed = await showConfirm(
                'Wszystkie dane zostanƒÖ usuniƒôte.',
                'ZaczƒÖƒá od nowa?',
                'üîÑ'
            );

            if (confirmed) {
                localStorage.removeItem('secret-santa-state-christmas');
                state = {
                    participants: [],
                    assignments: [],
                    currentIndex: 0,
                    hasDrawn: [],
                    budgetVotes: []
                };
                showScreen('setup-screen');
                renderParticipants();
                updateStartButton();
            }
        }

        // Show screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        // Helper: escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on load
        init();
    </script>
</body>
</html>